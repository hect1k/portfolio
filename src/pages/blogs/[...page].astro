---
import BaseLayout from "@layouts/Base.astro";
import { formatDate, formatBlogPosts } from "@utils";

export async function getStaticPaths({paginate}) {
  let blogs = await Astro.glob("../blogs/*.md");
  blogs = formatBlogPosts(blogs);

  return paginate(blogs, {
    pageSize: 3
  })
}

const {page} = Astro.props

---

<BaseLayout title={`Blogs by Nnisarg Gada${page.currentPage !== 1 ? ` - Page ${page.currentPage}` : ''}`}>
  <div class="w-screen max-w-5xl flex flex-col gap-12 mx-auto my-12 p-4">
    <h1 class="text-5xl font-bold">Blogs</h1>
    <div class="flex flex-col gap-6">
    {
      page.currentPage !== 1 && (
        <p class="italic">Page {page.currentPage} of {page.lastPage}</p>
      )
    }
    {page.data.map((blog: any) => 
      <a class="flex flex-col md:flex-row bg-white bg-opacity-20 hover:bg-opacity-30 rounded cursor-pointer transition-all ease-in-out duration-300" href={blog.url}>
        {(blog.frontmatter.image) && (
          <img class="h-40 aspect-square object-cover rounded-l" src={blog.frontmatter.image} alt="" />
        )}
        <div class="flex flex-col justify-evenly gap-4 p-4">
          <h2 transition:name={blog.frontmatter.title} class="text-3xl font-bold">{blog.frontmatter.title}</h2>
        <p transition:name={blog.frontmatter.date} class="text-xl">{formatDate(blog.frontmatter.date)}</p>
        </div>
      </a>
    )}
    </div>
    {
      page.currentPage === page.lastPage && (
        <p class="text-xl italic">More blogs coming soon :)</p>
      )
    }
    <div class="relative w-48 mx-auto">
      <a class={`absolute w-12 h-12 flex items-center justify-center left-0 bg-white bg-opacity-20 p-2 rounded cursor-pointer transition-all ease-in-out duration-300 ${!page.url.prev ? "opacity-40 cursor-not-allowed" : "hover:-translate-x-1 hover:bg-opacity-30"}`} href={page.url.prev}>
        <i class="fa-solid fa-arrow-left"></i>
      </a>
      <a class={`absolute w-12 h-12 flex items-center justify-center right-0 bg-white bg-opacity-20 p-2 rounded cursor-pointer transition-all ease-in-out duration-300 ${!page.url.next ? "opacity-40 cursor-not-allowed" : "hover:translate-x-1 hover:bg-opacity-30"}`} href={page.url.next}>
        <i class="fa-solid fa-arrow-right"></i>
      </a>
    </div>
  </div>
</BaseLayout>
