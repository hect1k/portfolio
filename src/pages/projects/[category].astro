---
import ScreenLayout from "@layouts/Screen.astro";
import { projects } from "@utils";

export function getStaticPaths() {

  const uniqueCategories: string[] = [];

  projects.forEach((project: any) => {
    project.categories.forEach((category: string) => {
      if (!uniqueCategories.includes(category)) {
        uniqueCategories.push(category);
      }
    });
  });
  
  return [
    ...uniqueCategories.map((category) => ({
      params: {
        category
      },
      props: {
        projects, category
      }
    }))
  ];
}

const { projects, category } = Astro.props;

const title = `${category.charAt(0).toUpperCase() + category.slice(1)} Projects by Nnisarg Gada`;

const filteredProjects = projects.filter((project: any) => project.categories.includes(category));

---

<ScreenLayout title={title}>
  <div class="w-full flex flex-col gap-6 p-6 md:py-24">
    <h1 class="text-5xl font-bold">Projects</h1>
      <p class="text-xl"><a class="text-accent italic underline" href={`/projects/${category}`}>#{category}</a> projects</p>
    <div class="flex items-center justify-between">
      <p class="text-lg">{filteredProjects.length} projects</p>
      <a class="text-accent" href="/projects">All Projects</a>
    </div>
    <div class="flex flex-col gap-6">
      {filteredProjects.map((project: any) => (
                <div class="md:max-h-60 flex flex-col md:flex-row bg-white bg-opacity-20 rounded shadow-lg shadow-black">
        {project.image && (
          <img class="w-full md:h-60 md:w-60 aspect-square object-cover rounded-t md:rounded-none md:rounded-l" src={`/images/projects/${project.image}`} alt={project.title} />
        )}
          <div class="w-full md:h-full flex flex-col gap-2">
            <div class="flex flex-col justify-evenly gap-4">
              <h2 class="text-3xl bg-black bg-opacity-50 font-bold p-4">{project.title}</h2>
              <p class="text-2xl font-semibold p-4 py-0">{project.description}</p>
            </div>
            <div class="flex flex-wrap gap-2 p-4 py-2 text-accent font-medium italic ">
              {project.categories.map((category) => (
                <a class="hover:underline" href={`/projects/${category}`}>
                #{category}
                </a>
              ))}
            </div>
            <div class="flex gap-4 p-4">
              {project.url && (
                <a class="bg-accent font-bold px-4 py-2 rounded transition-all ease-in-out duration-300 hover:drop-shadow-xl hover:-translate-y-1 hover:scale-105" href={project.url} target="_blank">Demo</a>
              )}
              {project.repo && (
                <a class="bg-black bg-opacity-30 font-bold px-4 py-2 rounded transition-all ease-in-out duration-300 hover:drop-shadow-xl hover:-translate-y-1 hover:scale-105" href={project.repo} target="_blank">Github Repo</a>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</ScreenLayout>
